<!DOCTYPE html>
<html lang="zh-Hant-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>百香果B2C｜會員</title>
    <link rel="stylesheet" href="./styles/myall.css">
    <link rel="stylesheet" href="./styles/style.css">
    <link rel="stylesheet" href="./styles/bootstrap.min.css">
    <link rel="shortcut icon" href="./icon/title.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        header {
            top: 0;
            z-index: 10;
        }

        .navtitle {
            background: linear-gradient(135deg, var(--mycolor8), var(--mycolor1));
        }

        #visitor {
            color: var(--mycolor3);
            font-size: 2rem;
            font-weight: bolder;
        }
    </style>
</head>

<body>
    <!-- 回上層按鈕 -->
    <!-- <div id="backtop" class="toTop-arrow">
        <img src="./images/LOGO.png">
    </div> -->
    <!-- 選單列 -->
    <header>
        <nav class="navbar navbar-expand-lg navtitle">
            <div class="container-fluid logo">
                <a class="navbar-brand" href="./index.html">
                    <img src="./images/LOGOone.png" alt="百香果B2C">
                    <p class="logotext">百香果B2C</p>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-link text-danger" aria-current="page" href="./index.html">百香果B2C</a>
                        <a class="nav-link" href="./about.html" target="_self">關於我們</a>
                        <a class="nav-link" href="./product.html" target="_self">商品訂購</a>
                        <a class="nav-link" href="./contactus.html" target="_self">聯絡我們</a>
                        <a class="nav-link" href="#" type="button" data-bs-toggle="modal"
                            data-bs-target="#suflist">訂單查詢</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    <!-- 登入彈出介面 -->
    <div class="modal fade" id="suflist">
        <!--讓上面的超連接來連結-->
        <div class="modal-dialog">
            <!--彈出框框-->
            <div class="modal-content">
                <!-- header -->
                <div class="modal-header">
                    <h3>訂單查詢</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <!-- body -->
                <div class="modal-body">
                    <div>
                        <div class="mb-3 username">
                            <label for="" class="form-label">訂單編號</label>
                            <input id="listname" type="text" class="form-control " placeholder="請輸入訂單編號">
                        </div>
                        <div class="mb-3 usermimi">
                            <label for="tel" class="form-label">電話</label>
                            <input id="tel" type="text" class="form-control" placeholder="請輸入電話號碼">
                        </div>
                        <div class="form-check form-switch">
                            <input type="checkbox" class="form-check-input" role="switch" name="sw1" id="sw1">
                            <label class="form-check-label" for="sw1">未確認資料</label>
                        </div>
                        <button id="OK_btn" class="btn btn-info" style="width: 100%;">確認</button>
                    </div>
                </div>
                <!-- footer -->
                <div class="modal-footer">
                    <a href="#" type="button">聯絡客服</a>
                </div>
            </div>
        </div>
    </div>

    <main class="main6">
        <div class="container">
            <div class="row">
                <div class="welcome mt-5" id="visitor"><i class="fa-solid fa-shop"></i>商家</div>
                <table class="table  table-striped mt-5 table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>訂單編號</th>
                            <th>訂購日期</th>
                            <th>電話</th>
                            <th>地址</th>
                            <th>訂單內容</th>
                            <th>總金額</th>
                            <th>修改/刪除</th>
                        </tr>
                    </thead>
                    <tbody id="show">
                        <tr>
                            <td id="fulist" data-th="訂單編號">XXXX</td>
                            <td id="fudate" data-th="訂購日期">XXXX</td>
                            <td id="futel" data-th="電話">XXXX</td>
                            <td id="fadd" data-th="地址">XXXX</td>
                            <td id="fruit" data-th="訂單內容">XXXX</td>
                            <td id="monmon" data-th="總金額">XXXX</td>
                            <td>
                                <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#updateModal" id="update_btn" data-flist="'+item.flist+'" data-id="'+item.ID+'"data-ftel="'+item.ftel+'"data-fcont="'+item.fcont+'"data-fadd="'+item.fadd+'"data-fmon="'+item.fmon+'">修改</button>
                                <button class="btn btn-danger" data-flist="' + item.flist + '" data-id="' + item.ID + '" id="delete_btn">刪除</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


        <!-- 修改畫面 -->
    <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">訂單修改</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="" class="form-label">訂單編號</label>
                        <input type="text" class="form-control" disabled id="m_flist">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label">訂單電話</label>
                        <input type="text" class="form-control" id="m_ftel">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label">訂單住址</label>
                        <input type="text" class="form-control" id="m_fadd">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label">訂單內容</label>
                        <input type="number" class="form-control" id="m_fcont">
                    </div>
                    <div class="mb-3">
                        <label for="" class="form-label">總金額</label>
                        <input type="text" class="form-control" id="m_fmon" disabled>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="m_update_btn">修改</button>
                </div>
            </div>
        </div>
    </div>
    </main>
    <!-- 頁尾 -->
    <footer class="footer">
        <div>
            <p>Copyright © 2023 GaWei. All rights reserved.</p>
        </div>
    </footer>

    <script src="./js/Jquery.js"></script>
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/list.js"></script>



    <script>
        let p_id;
        let p_flist;
        $(function () {
            //呈現表單
            $.ajax({
                type: "GET",
                url: "./20231211-Readdb.php",
                dataType: "json",
                async:false,
                success: showdata,
                error: function () {
                    alert("NO");
                }
            });

            //監聽修改按鈕update_btn
           $("#show #update_btn").click(function () {
                // console.log($(this).data("id"));
                // console.log($(this).data("flist"));
                // console.log($(this).data("fadd"));
                // console.log($(this).data("ftel"));
                // console.log($(this).data("fcont"));
                // console.log($(this).data("fmon"));
                p_id = $(this).data("id");
                p_flist = $(this).data("flist");
                $("#m_flist").val($(this).data("flist"));
                $("#m_fadd").val($(this).data("fadd"));
                $("#m_ftel").val($(this).data("ftel"));
                $("#m_fcont").val($(this).data("fcont"));
                $("#m_fmon").val($(this).data("fmon"));
                $("#m_fcont").bind("input propertychange",function(){
                    console.log($(this).val());
                    $("#m_fmon").val($(this).val()*500);
                });
                
            });
            

            //監聽modal修改按鈕  m_update_btn
            $("#m_update_btn").click(function(){
                console.log(p_id);
                console.log(p_flist);
                console.log($("#m_ftel").val());
                console.log($("#m_fmon").val());
                if(confirm("確定修改?")){
                    $.ajax({
                    type:"POST",
                    url:"./20231211-Updatadb4.php",
                    data:{flist:p_flist,ftel:$("#m_ftel").val(),fadd:$("#m_fadd").val(),fcont:$("#m_fcont").val(),fmon:$("#m_fmon").val()},
                    success:showdata_updata,
                    error:function(){
                        alert("更新失敗!");
                    }
                });
                }
            });

            //監聽刪除按鈕delete_btn
            $("#show #delete_btn").click(function () {
                if(confirm("確認要刪除" + $(this).data("flist") +"嗎?")){
                    console.log($(this).data("flist"));
                    //傳遞至後端20231211-DeleteDB.php 執行刪除行為
                    $.ajax({
                        type: "POST",
                        url: "20231211-DeleteDB.php",
                        data: {flist: $(this).data("flist")},
                        success: showdata_delete,
                        error: function(){
                            alert("刪除錯誤!");
                        }
                    });
                }
            });
        });

        
        function showdata(data) {
            $("#show").empty();
            data.forEach(function (item) {
                let strhtml = '<tr><td id="fulist" data-th="訂單編號">' + item.flist + '</td><td id="fudate" data-th="訂購日期">' + item.fdate + '</td><td id="futel" data-th="電話">' + item.ftel + '</td><td id="fadd" data-th="地址">' + item.fadd + '</td><td id="fruit" data-th="訂單內容">' + item.fcont + '箱</td><td id="monmon" data-th="總金額">' + item.fmon + '</td><td><button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#updateModal" id="update_btn" data-flist="'+item.flist+'" data-id="'+item.ID+'"data-ftel="'+item.ftel+'"data-fcont="'+item.fcont+'"data-fadd="'+item.fadd+'"data-fmon="'+item.fmon+'">修改</button><button class="btn btn-danger" data-flist="' + item.flist + '" data-id="' + item.ID + '" id="delete_btn">刪除</button></td></tr>';
                $("#show").append(strhtml);
            });
        }

        //刪除
        function showdata_delete() {
            // console.log("OK");
            alert("刪除成功");
            location.href = "./login.html";
        }
        //更新
        function showdata_updata(data){
            console.log("更新成功!");
            location.href="./login.html";
        }

    </script>
</body>

</html>